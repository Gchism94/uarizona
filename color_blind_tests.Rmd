--
title: "color_blind_tests"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{color_blind_tests}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 80
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Library

```{r}
library(colorBlindness)
library(dplyr)
library(dichromat)
library(cowplot)
library(colorblindr)
library(colorspace)
library(colordistance)
library(magrittr)
library(duke)
library(palmerpenguins)
library(colorratio)
#remotes::install_github("matt-dray/coloratio")
```

# Color-Blindness Tests

```{r}
# with white text
AAA_colors <- c("#012169", "#00539B", "#005587", "#262626")
AA_colors <- c("#C84E00", "#1D6363", "#0577B1", "#993399", "#666666")
AA18_colors <-  c("#339898", "#988675")

```

```{r}
knitr::knit_exit()
```

## colorBlindness package

```{r, warning = FALSE}
values1 <- c("#00539B", "#339898", "#C84E00", "#A1B70D", "#E89923",
                       "#993399", "#012169", "#262626")
values2 <- c("#00539B", "#C84E00","#339898", "#A1B70D", "#993399", "#E89923",
                      "#012169", "#262626")
values3 <- c("#00539B", "#C84E00","#339898", "#A1B70D", "#993399", "#988675",
                      "#012169", "#262626")  
values4 <- c("#00539B", "#E89923", "#012169","#993399", "#339898","#A1B70D",
                          "#262626", "#C84E00")     
all_values <- c("#00539B", "#339898", "#C84E00", "#A1B70D", "#E89923",
                       "#993399", "#012169", "#262626", "#988675", "#FFD960", "#1D6363", "#E2E6ED", "#F3F2F1", "#FCF7E5", "#DAD0C6", "#666666", "#B5B5B5", "#E5E5E5", "#FFFFFF")
                    
colorBlindness::displayAllColors(values1)
colorBlindness::displayAllColors(values2)
colorBlindness::displayAllColors(values3)
```

## Dichromat package

```{r}
# Option 1
pars <- par(mfrow=c(2,2), mar=c(0,0,2,0))
barplot(rep(1,8), yaxt="n", col=values1, main="True")
barplot(rep(1,8), yaxt="n", col=dichromat(values1, type="protan"), main="Protanopia")
barplot(rep(1,8), yaxt="n", col=dichromat(values1, type="deutan"), main="Deutanopia")
barplot(rep(1,8), yaxt="n", col=dichromat(values1, type="tritan"), main="Tritanopia")
```

```{r}
# Option 2
pars <- par(mfrow=c(2,2), mar=c(0,0,2,0))
barplot(rep(1,8), yaxt="n", col=values2, main="True")
barplot(rep(1,8), yaxt="n", col=dichromat(values2, type="protan"), main="Protanopia")
barplot(rep(1,8), yaxt="n", col=dichromat(values2, type="deutan"), main="Deutanopia")
barplot(rep(1,8), yaxt="n", col=dichromat(values2, type="tritan"), main="Tritanopia")
```

```{r}
# Option 3
pars <- par(mfrow=c(2,2), mar=c(0,0,2,0))
barplot(rep(1,8), yaxt="n", col=values3, main="True")
barplot(rep(1,8), yaxt="n", col=dichromat(values3, type="protan"), main="Protanopia")
barplot(rep(1,8), yaxt="n", col=dichromat(values3, type="deutan"), main="Deutanopia")
barplot(rep(1,8), yaxt="n", col=dichromat(values3, type="tritan"), main="Tritanopia")
```

## Colorblindr package

```{r}
# Dumby Dataset for Increased Categories
Student <- c("Jack", "Annie", "Paul", "Aidan", "Jake", "Josh", "Grace", "Suzy", "Beth", "Taylor", "Tanner", "Lisa", "Jimmy", "Larry", "Patricia", "Laura", "Yasmin", "Tim")
Grade <- c("A+", "B", "A+", "C", "D", "A+", "E", "C", "B-", "B-", "D", "A-", "B+", "A-", "A-", "D", "B", "E")

Height <- c(60, 72, 54, 65, 77, 44, 56, 59, 47, 60, 62, 65, 73, 45, 54, 53, 58, 65)
Weight <- c(145, 150, 147, 145, 143, 144, 140, 144, 149, 146, 142, 148, 143, 143, 144, 150, 148, 144)

dumby_df <- data.frame(Student, Grade, Height, Weight)
```

### Barplot

```{r, warning = FALSE}
bplot <- dumby_df %>%
  ggplot(aes(x = Grade, fill = Grade)) + 
  geom_bar() + 
  labs(title = "Grade Distribution") +
  theme_duke()

cvd_grid(bplot + scale_duke_fill_discrete(1))
```

```{r, warning = FALSE}
# Option 1
b2 <- edit_colors(bplot +
                    scale_duke_fill_discrete(num = 1), deutan, sev = 0.7)
cowplot::plot_grid(bplot +
                     scale_duke_fill_discrete(num = 1), b2)

# Option 2
b3 <- edit_colors(bplot +
                    scale_duke_fill_discrete(num = 2), deutan, sev = 0.7)
cowplot::plot_grid(bplot +
                     scale_duke_fill_discrete(num = 2), b3)

# Option 3
b4 <- edit_colors(bplot +
                    scale_duke_fill_discrete(num = 3), deutan, sev = 0.7)
cowplot::plot_grid(bplot +
                     scale_duke_fill_discrete(num = 3), b4)
```

### Scatterplot

```{r, message = FALSE}
splot <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, 
                              color = species)) +
  geom_point() +
  labs(title = "Flipper Length v. Depth") +
    theme_duke()

cvd_grid(splot)
```

```{r, warning = FALSE, message=FALSE}
# Option 1
s2 <- edit_colors(splot +
                    scale_duke_color_discrete(num = 1), deutan, sev = 0.7)
cowplot::plot_grid(splot +
                     scale_duke_color_discrete(num = 1), s2)

# Option 2
s3 <- edit_colors(splot +
                    scale_duke_color_discrete(num = 2), deutan, sev = 0.7)
cowplot::plot_grid(splot +
                    scale_duke_color_discrete(num = 2), s3)

# Option 3
s4 <- edit_colors(splot +
                    scale_duke_color_discrete(num = 3), deutan, sev = 0.7)
cowplot::plot_grid(splot +
                    scale_duke_color_discrete(num = 3), s4)

s5 <- edit_colors(splot +
                    scale_duke_color_discrete(num = 4), deutan, sev = 0.7)
cowplot::plot_grid(splot +
                    scale_duke_color_discrete(num = 4), s5)

```

## colordistance package

```{r matrix}

lower <- c(0.99, 0.99, 0.99)
upper <- c(1, 1, 1)

images <- c("~/Desktop/Thesis/duke/colors/CastIron.png", "~/Desktop/Thesis/duke/colors/Copper.png", "~/Desktop/Thesis/duke/colors/DukeNavyBlue.png", "~/Desktop/Thesis/duke/colors/DukeRoyalBlue.png", "~/Desktop/Thesis/duke/colors/Eno.png", "~/Desktop/Thesis/duke/colors/Ironweed.png", "~/Desktop/Thesis/duke/colors/Persimmon.png", "~/Desktop/Thesis/duke/colors/Piedmont.png")

histList <- colordistance::getHistList(images = images, lower=lower, 
                                       upper=upper, bins=rep(2, 3), 
                                       plotting=FALSE, pausing=FALSE)

CDM <- colordistance::getColorDistanceMatrix(histList, method="color.dist", plotting=FALSE)
```

```{r heatmap, message=FALSE}
par(mar= c(1,1,1,1))
colordistance::heatmapColorDistance(CDM)
```

This heatmap is produced using the color distances between each pair of Duke
official colors. Blue cells indicate a lower distance, and therefore, a higher
similarity between the colors. Pink cells indicate a higher distance, and
therefore, a lower similarity between the colors. This heatmap uses Euclidean
distance as its metric for similarity. Euclidean distance is:

${\displaystyle {\text{distance}}={\sqrt {(R_{2}-R_{1})^{2}+(G_{2}-G_{1})^{2}+(B_{2}-B_{1})^{2}}}.}$

Based on the heat map, we can determine the following color differences:

**Good:**

\- Cast-Iron + Ironweed

\- Navy Blue + Ironweed

\- Navy Blue + Eno

\- Eno + Ironweed

\- Ironweed + Persimmon

\- Eno + Persimmon

\- Royal + Navy Blue

\- Royal + Ironweed

**Moderate:**

\- Cast-Iron + Eno

\- Cast-Iron + Persimmon

\- Royal + Eno

**Bad:**

\- Cast-Iron + Navy Blue

\- Cast-Iron + Copper

\- Cast-Iron + Piedmont

Euclidean distance is a popular measure for color difference; however, it is
perceptually uniform. This means that color pairings that have similar Euclidean
distances can appear vastly different perceptually [8]. This is because of
irregularity in the standard RGB (sRGB) color space, which causes evenly spaced
hues to range in their perceptual similarity or difference [8]. The CIE
chromaticity diagram (see Figure X) exhibits the color spectrum according to
human vision. Its parabolic nature leads to irregularities in linearly scaled
color scales and therefore weakens its efficacy in this context.

![Figure X: CIE chromaticity
diagram.](images/chromaticity-diagram.jpg){width="300"}

## colorratio package

The `coloratio` package is intended to aid users with color selection for their R outputs. We will use it to calculate the contrast ratios between all color pairings, informing our palette makeup selection process. Color-contrast values are the primary metric used to decide WCAG standards, and thus, are crucial to consider in the package development process. 

```{r colorratio, warning = false}
colorcontrasts = c()

for(i in 1:length(all_values)) {
  j = 1
  while(j <= length(all_values)) {
    contrast <- cr_get_ratio(all_values[i], all_values[j])
    colorcontrasts <- append(colorcontrasts, contrast)
    j = j +1
  }
}
ratioMatrix = matrix(colorcontrasts, nrow = length(all_values), ncol = length(all_values))
rownames(ratioMatrix) <- c("Duke Royal Blue", "Eno", "Copper", "Piedmont", "Persimmon", "Ironweed", "Duke Navy Blue", "Cast Iron", "Dogwood", "Dandelion", "Magnolia", "Hatteras", "Whisper Gray", "Ginger Beer", "Shackleford", "Graphite", "Granite", "Limestone", "White")
colnames(ratioMatrix) <-  c("Duke Royal Blue", "Eno", "Copper", "Piedmont", "Persimmon", "Ironweed", "Duke Navy Blue", "Cast Iron", "Dogwood", "Dandelion", "Magnolia", "Hatteras", "Whisper Gray", "Ginger Beer", "Shackleford", "Graphite", "Granite", "Limestone", "White")

mat_melt <-  melt(ratioMatrix)
```

```{r heatmap}
#heatmap(ratioMatrix, Rowv = NA, Colv = NA)
ggp <- ggplot(mat_melt, aes(Var1, Var2)) +                           
# Create heatmap with ggplot2
  geom_tile(aes(fill = value)) +
  labs(title = "Color-Contrast Ratios Between Color Pairings", x = "Color 1", y = "Color 2") +
  theme_duke() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggp        
```

Based on the heatmap and matrix created above, the following coloring pairings meet the AA WCAG standard of a 4.5+ contrast ratio:

```{r}
mat_melt %>%
  filter(value >= 3) %>%
  filter(Var1 != "White" & Var2 != "White") %>%
  arrange(desc(value))

white_comp <- mat_melt %>%
  filter(Var1 == "White" | Var2 == "White") %>%
  arrange(value) %>%
  filter(value < 4.5)
white_comp

white_list <- c("Ginger Beer", "Whisper Gray", "Hatteras", "Limestone", "Dandelion", "Shackleford", "Granite", "Piedmont","Persimmon")

mat_melt %>%
  filter(value >= 3) %>%
  filter(Var1 == "Duke Navy Blue" | Var2 == "Duke Navy Blue") %>%
  arrange(desc(value))
```
We must first take into account how the colors with interact with our minimalist white background. Colors that are below an AA18 rating will be difficult to distinguish - particularly when using more tedious plots (ie. scatterplot) - and therefore, should be removed from our potential color palette. These colors are Ginger Beer, Whisper Gray, Hatteras, Limestone, Dandelion, Shackleford, Granite, Piedmont, and Persimmon.

According to the Duke Branding Office, it is important that either Duke Royal Blue or Duke Navy Blue is one of the primary colors used. Thus, we will incorporate one of the two as the first color in our palette.

Duke Navy Blue, Piedmont, Persimmon, Duke Royal Blue, Eno, Copper, Cast Iron, Ironweed

Colors to be used:
Duke Navy Blue, Ginger Beer, Duke Royal Blue, Magnolia, Ironweed, Dandelion, Cast Iron, Piedmont  

Duke Navy Blue, Piedmont, 
** NEEDS TO BE ADJUSTED

```{r}
col_vals <- c("#012169", "#FCF7E5", "#00539B", "#1D6363", "#993399", "#FFD960", "#262626", "#A1B70D")
col_names1 <- c("Duke Navy Blue", "Ginger Beer", "Duke Royal Blue", "Magnolia", "Ironweed", "Dandelion", "Cast Iron", "Piedmont")

col_names2 <- c("Duke Navy Blue", "Piedmont", "Persimmon", "Duke Royal Blue", "Eno", "Copper", "Cast Iron", "Ironweed")

mat_melt %>%
  dplyr::filter(Var1 %in% col_names2 & Var2 %in% col_names2) %>%
  dplyr::arrange(desc(value))

ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = species)) +
  geom_point() +
  scale_color_manual(values = c("#012169","#C84E00", "#00539B"))

carsdf <- carsdf%>%
  slice(1:4)

ggplot(carsdf, aes(mpg, hp, color = names)) +
  geom_point() +
  scale_color_manual(values = c("#012169","#C84E00", "#00539B", "#A1B70D"))
```
By taking our colors of interest, we will order them based on their contrast ratios. More specifically, color pairs with the smallest contrast ratios will be placed further away from one another on the palette. 

```{r}
col_vals <- c("#012169","#A1B70D", "#00539B", "#339898", "#C84E00", "#993399", "#262626", "#E89923")

col_names1 <- c("Duke Navy Blue", "Piedmont", "Duke Royal Blue", "Eno", "Copper", "Ironweed", "Persimmon", "Cast Iron")

dumby_df %>%
  ggplot(aes(x = Weight, y = Height, color = Grade)) + 
  geom_point() + 
  labs(title = "Grade Distribution") +
  theme_duke() +
  scale_color_manual(values =  c("#012169","#A1B70D", "#00539B", "#339898", "#C84E00", "#993399", "#262626", "#E89923"),  aesthetics = "colour")
```

Potential Order: Duke Navy Blue, Piedmont, Duke Royal Blue, Copper, Eno,Ironweed, Persimmon, Cast Iron
```{r}
b5 <- edit_colors(bplot +
                    scale_duke_fill_discrete(num = 5), deutan, sev = 0.7)
cowplot::plot_grid(bplot +
                     scale_duke_fill_discrete(num = 5), b5)
```


# References:

<https://www.datanovia.com/en/blog/how-to-stimulate-colorblindness-vision-in-r-figures/>

<http://australianantarcticdatacentre.github.io/GentleR/2015-07-23/dichromat.pdf>

<https://brand.duke.edu/colors/>

<https://ggplot2-book.org/scale-colour.html>

<https://hiweller.github.io/colordistance/colordistance-introduction.html>

<https://en.wikipedia.org/wiki/Color_difference>

<https://www.baeldung.com/cs/compute-similarity-of-colours>

<https://iopscience.iop.org/article/10.1088/1742-6596/1098/1/012028/pdf>

<https://hiweller.github.io/colordistance/colordistance-introduction.html>

[8]
<https://programmingdesignsystems.com/color/perceptually-uniform-color-spaces/>
